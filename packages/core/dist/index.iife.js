!function(e,t,n){function r(e,n){return(r=t.parseSync("("+e+")",n).body[0])&&"ExpressionStatement"===r.type&&"ParenthesisExpression"===r.expression.type?r.expression.expression:{type:"Invalid",span:{start:0,end:0,ctxt:0}};var r}function a(e,n){return t.parseSync(`type A = ${e}`,Object.assign(Object.assign({},n),{syntax:"typescript"})).body[0].typeAnnotation}const s={type:"TsFunctionType",span:{start:199,end:221,ctxt:0},params:[{type:"RestElement",span:{start:203,end:215,ctxt:0},rest:{start:5691,end:5694,ctxt:0},argument:{type:"Identifier",span:{start:206,end:210,ctxt:4},value:"args",optional:!1},typeAnnotation:{type:"TsTypeAnnotation",span:{start:210,end:215,ctxt:0},typeAnnotation:{type:"TsArrayType",span:{start:212,end:215,ctxt:0},elemType:{type:"TsTypeReference",span:{start:212,end:213,ctxt:0},typeName:{type:"Identifier",span:{start:212,end:213,ctxt:4},value:"T",optional:!1}}}}}],typeParams:{type:"TsTypeParameterDeclaration",span:{start:199,end:202,ctxt:0},parameters:[{type:"TsTypeParameter",span:{start:200,end:201,ctxt:0},name:{type:"Identifier",span:{start:200,end:201,ctxt:4},value:"T",optional:!1},in:!1,out:!1}]},typeAnnotation:{type:"TsTypeAnnotation",span:{start:217,end:221,ctxt:0},typeAnnotation:{type:"TsTypeReference",span:{start:220,end:221,ctxt:0},typeName:{type:"Identifier",span:{start:220,end:221,ctxt:4},value:"T",optional:!1}}}},i={type:"TsFunctionType",span:{start:182,end:192,ctxt:0},params:[],typeParams:{type:"TsTypeParameterDeclaration",span:{start:182,end:185,ctxt:0},parameters:[{type:"TsTypeParameter",span:{start:183,end:184,ctxt:0},name:{type:"Identifier",span:{start:183,end:184,ctxt:4},value:"T",optional:!1},in:!1,out:!1}]},typeAnnotation:{type:"TsTypeAnnotation",span:{start:188,end:192,ctxt:0},typeAnnotation:{type:"TsTypeReference",span:{start:191,end:192,ctxt:0},typeName:{type:"Identifier",span:{start:191,end:192,ctxt:4},value:"T",optional:!1}}}},p={type:"TsKeywordType",span:{start:236,end:242,ctxt:0},kind:"string"};function o(e,n){const{code:r,map:a}=t.printSync({type:"Script",span:E,body:Array.isArray(e)?e:[e]},n);return{code:r.trim(),map:a}}async function l(e,n){const{code:r,map:a}=await t.print({type:"Script",span:E,body:Array.isArray(e)?e:[e]},n);return{code:r.trim(),map:a}}function c(e,t){const{code:n,map:r}=o({type:"ExpressionStatement",span:E,expression:e},t);return{code:n.replace(/\s*;\s*$/,""),map:r}}function u(e,t){const{code:n,map:r}=o({type:"TsTypeAliasDeclaration",span:E,declare:!1,id:{type:"Identifier",span:E,value:"__PrintType__",optional:!1},typeAnnotation:e},t);return{code:n.replace(/\s*type\s+__PrintType__\s*=\s*/,"").replace(/\s*;\s*$/,""),map:r}}var y=D({enter(e){const t=this.get("scopeVars",[[]]);function n(e,n=undefined){var r,a;if("Identifier"===e.type)null===(r=t[t.length-1])||void 0===r||r.push({name:e.value,value:n,marker:e.marker});else{if("PrivateName"!==e.type)throw new Error(`Unhandled type ${e.type}!`);null===(a=t[t.length-1])||void 0===a||a.push({name:e.id.value,value:n,marker:e.marker,private:!0})}}function r(e){for(const t of e.properties)"AssignmentPatternProperty"===t.type?n(t.key):"RestElement"===t.type&&n(t.argument)}function a(e){for(const t of e.elements)t&&("Identifier"===t.type?n(t):"RestElement"===t.type?n(t.argument):"ObjectPattern"===t.type?r(t):"ArrayPattern"===t.type&&a(t))}function s(e){t.push([]);for(const t of e)switch(t.type){case"Identifier":n(t);break;case"RestElement":n(t.argument);break;case"AssignmentPattern":"Identifier"===(s=t).left.type?n(s.left,s.right):"ArrayPattern"===s.left.type?a(s.left):"ObjectPattern"===s.left.type&&r(s.left)}var s}if("FunctionDeclaration"===e.type)n(e.identifier,e),s(e.params.map((e=>e.pat)));else if("FunctionExpression"===e.type)s(e.params.map((e=>e.pat)));else if("ArrowFunctionExpression"===e.type)s(e.params);else if("ClassDeclaration"===e.type)n(e.identifier,e);else if("ClassMethod"===e.type)n(e.key),s(e.function.params.map((e=>e.pat)));else if("PrivateMethod"===e.type)n(e.key.id),s(e.function.params.map((e=>e.pat)));else if("VariableDeclaration"===e.type)for(const i of e.declarations)"Identifier"===i.id.type?n(i.id,i.init):"ArrayPattern"===i.id.type?a(i.id):"ObjectPattern"===i.id.type&&r(i.id);else if("CatchClause"===e.type){t.push([]);const s=e.param;s&&("Identifier"===s.type?n(s):"ArrayPattern"===s.type?a(s):"ObjectPattern"===s.type&&r(s))}else if("ImportDeclaration"===e.type)for(const i of e.specifiers)n(i.local)},leave(e){(["FunctionDeclaration","FunctionExpression","ArrowFunctionExpression","ClassDeclaration","ClassMethod","ClassPrivateMethod"].includes(e.type)||"CatchClause"===e.type)&&this.get("scopeVars",[[]]).pop()}});class d{constructor({enter:e,leave:n},s,i=!1){this.node={type:"Invalid",span:E},this.data={},this.imports=[],this.exports=[],this.prepends=[],this.appends=[],this.globalDts=[],this.moduleDts=[],this.references=[],this.prependDts=[],this.appendDts=[],this.importHashes={},this.exportHashes={},this.enters=[],this.leaves=[],this.enableTracker=!1,this.spanOffset=0,this.set=(e,t)=>{this.data[e]=t},this.get=(e,t)=>(e in this.data||(this.data[e]=t),this.data[e]||t),this.import=(e,t,n=!1)=>{let r;const a=(e,t)=>{this.imports.push({type:"ImportDeclaration",specifiers:e,source:{type:"StringLiteral",value:t,span:{start:0,end:0,ctxt:0}},typeOnly:!1,span:{start:0,end:0,ctxt:0}}),this.importHashes[r]=!0};if(null==t&&"string"==typeof e)return r=v({pkg:e}),void(r in this.importHashes||a([],e));for(const s of"string"==typeof e?[e]:e)r=v({s:s,source:t,isDefault:n}),r in this.importHashes||a([L(s,n)],t)},this.export=(e,t,n=!1)=>{let r;for(const a of"string"==typeof e?[e]:e)r=v({s:a,source:t,isNamespace:n}),r in this.exportHashes||(this.exports.push({type:"ExportNamedDeclaration",specifiers:[P(a,n)],source:null==t?void 0:{type:"StringLiteral",value:t,span:{start:0,end:0,ctxt:0}},typeOnly:!1,span:{start:0,end:0,ctxt:0}}),this.exportHashes[r]=!0)},this.prepend=e=>this.prepends.push(...e),this.append=e=>this.appends.push(...e),this.addPlugin=e=>{const{enter:t,leave:n}=A(e);t&&this.enters.push(t),n&&this.leaves.push(n)},this.declareModule=(e,t)=>this.moduleDts.push({type:"TsModuleDeclaration",span:{start:312,end:341,ctxt:0},declare:!0,global:!1,id:{type:"StringLiteral",span:{start:327,end:334,ctxt:0},value:e},body:{type:"TsModuleBlock",span:{start:335,end:341,ctxt:0},body:Array.isArray(t)?t:[t]}}),this.declareGlobal=e=>Array.isArray(e)?this.globalDts.push(...e):this.globalDts.push(e),this.declareGlobalConst=(e,t)=>this.declareGlobal(k(e,"string"==typeof t?a(t):t)),this.declareReference=({types:e,path:t})=>this.references.push({types:e,path:t}),this.declarePrepend=e=>this.prependDts.push(...e),this.declareAppend=e=>this.appendDts.push(...e),this.defaultContext={span:()=>{const e=this.node.span.start,t=this.node.span.end;return[e>this.spanOffset?e-this.spanOffset-1:0,t>this.spanOffset?t-this.spanOffset-1:0]},set:this.set,get:this.get,track:this.track,import:this.import,export:this.export,prepend:this.prepend,append:this.append,parseExpr:r,parseType:a,parse:(e,n)=>t.parseSync(e,n).body,printExpr:e=>c(e).code,printType:e=>u(e).code,addPlugin:this.addPlugin,startTracking:()=>this.enableTracker=!0,stopTracking:()=>this.enableTracker=!1,declareAppend:this.declareAppend,declareGlobal:this.declareGlobal,declareModule:this.declareModule,declarePrepend:this.declarePrepend,declareReference:this.declareReference,declareGlobalConst:this.declareGlobalConst},e&&this.enters.push(e),n&&this.leaves.push(n),this.src=s,this.enableTracker=i}walkSingle(e,t,n,r){let a,s,i,p=0;this.node=e;const l=Object.assign(Object.assign({src:this.src},this.defaultContext),{skip:()=>{s=!0},print:t=>o(t||e).code,remove:()=>{t&&n&&(null!=r?t[n].splice(r,1):delete t[n]),i=!0},replace:e=>{t&&n&&(null!=r?Array.isArray(e)?(t[n].splice(r,1,...e),p=e.length-1):t[n][r]=e:t[n]=e,a=e)}});if(this.enableTracker&&y.enter.apply(l,[e,t,n,r]),this.enters.forEach((a=>a.apply(l,[e,t,n,r]))),Array.isArray(a))this.walkMany(a,t);else if(!s&&!i)for(const[o,c]of Object.entries(a||e))c&&(Array.isArray(c)?this.walkMany(c,e,o):c.type&&this.walkSingle(c,e,o));return this.leaves.forEach((a=>a.apply(l,[e,t,n,r]))),this.enableTracker&&y.leave.apply(l,[e,t,n,r]),p}walkMany(e,t,n){let r=0;for(let a=0;a<e.length;a++)r>0?r-=1:r=this.walkSingle(e[a],t,n,a)}walk(e,t=0){if(this.spanOffset=t,Array.isArray(e)?this.walkMany(e):e.type&&this.walkSingle(e),!Array.isArray(e)&&("Module"===e.type||"Script"===e.type)){const t=[],n=[],r=[];for(const a of e.body)["ImportDeclaration"].includes(a.type)?t.push(a):["ExportDeclaration","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration"].includes(a.type)?n.push(a):r.push(a);e.body=[...t,...this.imports,...this.prepends,...r,...this.appends,...n,...this.exports]}return e}emit(){const e=[];let t;for(const r of this.references)t="/// <reference ",r.types&&(t+=`types="${r.types}"`),r.path&&(t+=`path="${r.path}"`),t+=" />\n",e.push(t);const n=this.globalDts.length>0?{type:"TsModuleDeclaration",span:{start:144,end:164,ctxt:0},declare:!0,global:!0,id:{type:"Identifier",span:{start:152,end:158,ctxt:1},value:"global",optional:!1},body:{type:"TsModuleBlock",span:{start:159,end:164,ctxt:0},body:this.globalDts}}:void 0;return(e.length>0?e.join(""):"")+o([...this.prependDts,...n?[n]:[],...this.moduleDts,...this.appendDts]).code.replace(/declare module global/g,"declare global")+"\nexport {}\n"}track(e){let t;const n=this.get("scopeVars",[[]]);for(let r=n.length-1;r>=0;r--){t=n[r];for(let n=t.length-1;n>=0;n--)if(t[n].name===e)return t[n]}}}function f(e,t){return new d(t).walk(e)}function h(e){return!(!e||!e.__macro_proxy__)}function m(e){let t=5381,n=(e=e.replace(/\r/g,"")).length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return(t>>>0).toString(36)}function x(){return t.parseSync("").span.end}function v(e){return m(JSON.stringify(e))}function g(e){return"[object RegExp]"===Object.prototype.toString.call(e)}const b=()=>{},E={start:0,end:0,ctxt:0};function T(e){return new Function(`return (${e})`)()}function S(e){return T(c(e).code)}function $(e){if(void 0===e)return{type:"Identifier",span:{start:0,end:0,ctxt:2},value:"undefined",optional:!1};if(e&&"object"==typeof e){if(g(e))return this.parseExpr(e.toString());if("span"in e&&"type"in e)return e}return this.parseExpr("function"==typeof e?e.toString():JSON.stringify(e))}function w(e,t,n,a=!1){if(a)throw new Error("optional is not supported.");const s="object"==typeof e?e:r(e.toString()),i={};s.params.forEach(((e,n)=>{const r="ArrowFunctionExpression"===s.type?e:e.pat;"Identifier"===r.type?i[r.value]=t[n]?{value:t[n]}:{}:"AssignmentPattern"===r.type&&"Identifier"===r.left.type&&(i[r.left.value]={value:t[n]||r.right})}));let p={type:"Invalid",span:{start:0,end:0,ctxt:0}};return s.body&&(f(s.body,{enter(e){if("Identifier"===e.type&&e.value in i){const t=i[e.value].value;t&&this.replace(t)}},leave(e){"ReturnStatement"===e.type&&e.argument&&(p=e.argument)}}),"BlockStatement"!==s.body.type&&(p=s.body)),p}function A(e){return Array.isArray(e)||(e=[e]),{enter(t,n,r,a){let s,i;const p=e=>{s=e.apply(this,[t,n,r,a]),s&&this.replace(s)};for(const o of e)"function"!=typeof o||h(o)?(o.enter&&p(o.enter),t.type in o&&(i=o[t.type],"function"==typeof i?p(i):"object"==typeof i&&i.enter&&p(i.enter))):p(o)},leave(t,n,r,a){let s,i;const p=e=>{s=e.apply(this,[t,n,r,a]),s&&this.replace(s)};for(const o of e)"object"==typeof o&&(o.leave&&p(o.leave),t.type in o&&(i=o[t.type],"object"==typeof i&&i.leave&&p(i.leave)))}}}function k(e,t){return{type:"VariableDeclaration",span:{start:163,end:242,ctxt:0},kind:"const",declare:!1,declarations:[{type:"VariableDeclarator",span:{start:169,end:242,ctxt:0},id:{type:"Identifier",span:{start:169,end:172,ctxt:3},value:e,optional:!1,typeAnnotation:{type:"TsTypeAnnotation",span:{start:172,end:242,ctxt:0},typeAnnotation:t}},definite:!1}]}}function _(e,t,n="const"){return{type:"VariableDeclaration",span:{start:19,end:73,ctxt:0},kind:n,declare:!1,declarations:[{type:"VariableDeclarator",span:{start:23,end:73,ctxt:0},id:{type:"Identifier",span:{start:23,end:29,ctxt:2},value:t,optional:!1,typeAnnotation:{type:"TsTypeAnnotation",span:{start:29,end:73,ctxt:0},typeAnnotation:{type:"TsTypeQuery",span:{start:31,end:73,ctxt:0},exprName:{type:"TsImportType",span:{start:38,end:73,ctxt:0},argument:{type:"StringLiteral",span:{start:45,end:65,ctxt:0},value:e},qualifier:{type:"Identifier",span:{start:67,end:73,ctxt:2},value:t,optional:!1}}}}},definite:!1}]}}function I(e){return{type:"TsTypeReference",span:{start:199,end:205,ctxt:0},typeName:{type:"Identifier",span:{start:199,end:205,ctxt:2},value:e,optional:!1}}}function M(e){let t=typeof e;return"function"===t?s:"symbol"===t?I("Symbol"):"object"===t&&g(e)?I("RegExp"):(null===e&&(t="null"),{type:"TsKeywordType",span:{start:199,end:205,ctxt:0},kind:t})}function L(e,t=!1){const n={type:"Identifier",value:e,span:{start:0,end:0,ctxt:1},optional:!1};return t?{type:"ImportDefaultSpecifier",local:n,span:{start:0,end:0,ctxt:0}}:{type:"ImportSpecifier",local:n,span:{start:0,end:0,ctxt:0},isTypeOnly:!1}}function P(e,t=!1){const n={type:"Identifier",value:e,span:{start:0,end:0,ctxt:1},optional:!1};return t?{type:"ExportNamespaceSpecifier",name:n,span:{start:0,end:0,ctxt:0}}:{type:"ExportSpecifier",orig:n,span:{start:0,end:0,ctxt:0},isTypeOnly:!1}}function D(e){return Reflect.set(e,"__macro_plugin__",!0),e}function j(e){return new Proxy(e,{get:(e,t)=>"proxy"===t?t=>new Proxy(t,{ownKeys:t=>[...Reflect.ownKeys(e),...Reflect.ownKeys(t)],has:(t,n)=>Reflect.has(e,n)||Reflect.has(t,n),get:(t,n)=>"__macro_proxy__"===n||Reflect.get(e,n)||Reflect.get(t,n)}):"__macro_plugin__"===t||Reflect.get(e,t)})}function C(e,t,n){return D("string"==typeof e?{Module(){this.declareGlobalConst(e,n||M(t))},Identifier(n){n.value!==e||this.track(e)||(this.replace($.apply(this,[t])),this.skip())}}:{Module(){let n;for(const[r,a]of Object.entries(e))t&&Object.keys(t).includes(r)?(n=t[r],this.declareGlobalConst(r,n)):this.declareGlobalConst(r,M(a))},Identifier(t){t.value in e&&!this.track(t.value)&&(this.replace($.apply(this,[e[t.value]])),this.skip())}})}function O(e,t,n=s){return j("object"==typeof t?{Module(){this.declareGlobalConst(e,n)},CallExpression:{enter(n){var r;if(t.enter&&"Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value))return t.enter.apply(this,[n.arguments.map((e=>e.expression)),null===(r=n.typeArguments)||void 0===r?void 0:r.params,n.callee.optional])},leave(n){var r;if(t.leave&&"Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value))return t.leave.apply(this,[n.arguments.map((e=>e.expression)),null===(r=n.typeArguments)||void 0===r?void 0:r.params,n.callee.optional])}}}:{Module(){this.declareGlobalConst(e,n)},CallExpression(n){var r;if("Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value)){const e=n.arguments.map((e=>e.expression)),a=null===(r=n.typeArguments)||void 0===r?void 0:r.params;return t.toString().startsWith("function")?t.apply(this,[e,a,n.callee.optional]):w(t,e,0,n.callee.optional)}}})}function R(e,t,n=i){return D("object"==typeof t?{Module(){this.declareGlobalConst(e,n)},CallExpression:{enter(n){var r;if(t.enter&&"Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value)){if(n.arguments.length>0)throw new Error("TypeMacro doesn't support call with args.");return t.enter.apply(this,[null===(r=n.typeArguments)||void 0===r?void 0:r.params,n.callee.optional])}},leave(n){var r;if(t.leave&&"Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value)){if(n.arguments.length>0)throw new Error("TypeMacro doesn't support call with args.");return t.leave.apply(this,[null===(r=n.typeArguments)||void 0===r?void 0:r.params,n.callee.optional])}}}}:{Module(){this.declareGlobalConst(e,n)},CallExpression(n){var r;if("Identifier"===n.callee.type&&n.callee.value===e&&!this.track(n.callee.value)){if(n.arguments.length>0)throw new Error("TypeMacro doesn't support call with args.");const e=null===(r=n.typeArguments)||void 0===r?void 0:r.params;return t.apply(this,[e,n.callee.optional])}}})}function F(e,t,n=p){return D({Module(){this.declareGlobalConst(e,{type:"TsFunctionType",span:{start:174,end:242,ctxt:0},params:[{type:"Identifier",span:{start:175,end:204,ctxt:2},value:"strings",optional:!1,typeAnnotation:{type:"TsTypeAnnotation",span:{start:182,end:204,ctxt:0},typeAnnotation:{type:"TsTypeReference",span:{start:184,end:204,ctxt:0},typeName:{type:"Identifier",span:{start:184,end:204,ctxt:2},value:"TemplateStringsArray",optional:!1}}}},{type:"RestElement",span:{start:206,end:231,ctxt:0},rest:{start:207,end:210,ctxt:0},argument:{type:"Identifier",span:{start:209,end:220,ctxt:2},value:"expressions",optional:!1},typeAnnotation:{type:"TsTypeAnnotation",span:{start:220,end:231,ctxt:0},typeAnnotation:{type:"TsArrayType",span:{start:222,end:231,ctxt:0},elemType:{type:"TsKeywordType",span:{start:222,end:229,ctxt:0},kind:"unknown"}}}}],typeAnnotation:{type:"TsTypeAnnotation",span:{start:233,end:242,ctxt:0},typeAnnotation:"string"==typeof n?this.parseType(n):n}})},TaggedTemplateExpression:{enter(n){var r;if("Identifier"===n.tag.type&&n.tag.value===e)return null===(r="object"==typeof t?t.enter:t)||void 0===r?void 0:r.apply(this,[n.template.quasis.map((e=>e.raw)),...n.template.expressions])},leave(e){if("object"==typeof t&&t.leave&&"Identifier"===e.tag.type)return t.leave.apply(this,[e.template.quasis.map((e=>e.raw)),...e.template.expressions])}}})}function N(e,t){return D({LabeledStatement:{enter(n,r,a,s){var i;if(n.label.value===e)return null===(i="object"==typeof t?t.enter:t)||void 0===i?void 0:i.apply(this,[n.body,r,a,s])},leave(n,r,a,s){var i;if(n.label.value===e&&"object"==typeof t)return null===(i=t.leave)||void 0===i?void 0:i.apply(this,[n.body,r,a,s])}}})}function G(e,t,n=0){return r=>{var a;const s=new d(A(e.macros||[]),t,!0);if(r=s.walk(r,n),e.emitDts){const t=s.emit();null===(a=e.onEmitDts)||void 0===a||a.call(e,t),r.dts=t}return r}}function B(e,t,n,r=0){return G(t,n,r)(e)}var V=b,J=b;const H=D({Module(){this.declareGlobal(["$Macro","$LitMacro","$ExprMacro","$TypeMacro","$TmplMacro","$LabeledMacro"].map((e=>_("@macro-plugin/core",e,"var"))))},LabeledStatement:{enter(e){var t;if("macro"!==e.label.value)return;this.stopTracking();const n=this.get("ExprMacros",{}),r=this.get("LitMacros",{}),a=[],s="BlockStatement"===e.body.type?e.body.stmts:[e.body],i=(e,t)=>{if("Identifier"===e.type)a.push(C(e.value,t));else if("ArrayPattern"===e.type)e.elements.forEach(((e,n)=>{e&&i(e,t?{type:"MemberExpression",span:{start:342,end:348,ctxt:0},object:t,property:{type:"Computed",span:{start:345,end:348,ctxt:0},expression:{type:"NumericLiteral",span:{start:346,end:347,ctxt:0},value:n}}}:void 0)}));else{if("ObjectPattern"!==e.type)throw new Error("Unexpected macro type.");e.properties.forEach((n=>{if("AssignmentPatternProperty"===n.type&&null==n.value)i(n.key,t?{type:"MemberExpression",span:{start:342,end:353,ctxt:0},object:{type:"ParenthesisExpression",span:{start:342,end:353,ctxt:0},expression:t},property:{type:"Computed",span:{start:345,end:353,ctxt:0},expression:{type:"StringLiteral",span:{start:346,end:352,ctxt:0},value:n.key.value}}}:void 0);else{if("RestElement"!==n.type)throw new Error("Unexpected Object Pattrn type.");i(n.argument,t?{type:"ArrowFunctionExpression",span:{start:368,end:427,ctxt:0},params:[],body:{type:"BlockStatement",span:{start:374,end:427,ctxt:0},stmts:[{type:"VariableDeclaration",span:{start:380,end:409,ctxt:0},kind:"const",declare:!1,declarations:[{type:"VariableDeclarator",span:{start:386,end:409,ctxt:0},id:e,init:t,definite:!1}]},{type:"ReturnStatement",span:{start:414,end:423,ctxt:0},argument:n.argument}]},async:!1,generator:!1}:void 0)}}))}};for(const p of s)if("VariableDeclaration"===p.type&&"var"===p.kind)for(const e of p.declarations)if("Identifier"===e.id.type&&e.init)if(["FunctionExpression","ArrowFunctionExpression","FunctionDeclaration"].includes(e.init.type))n[e.id.value]=e.init;else if("CallExpression"===e.init.type&&"Identifier"===e.init.callee.type)switch(e.init.callee.value){case"$LitMacro":r[e.id.value]=e.init.arguments[0].expression;break;case"$ExprMacro":a.push(O(e.id.value,S(e.init.arguments[0].expression)));break;case"$TmplMacro":a.push(F(e.id.value,S(e.init.arguments[0].expression)));break;case"$TypeMacro":a.push(R(e.id.value,S(e.init.arguments[0].expression)));break;case"$LabeledMacro":case"$Macro":throw new Error("VariableDeclaration is not expected for $Labeled and $Macro.");default:i(e.id,e.init)}else i(e.id,e.init);else i(e.id,e.init);else if("ExpressionStatement"===p.type&&"CallExpression"===p.expression.type&&"Identifier"===p.expression.callee.type)switch(p.expression.callee.value){case"$LabeledMacro":a.push(N("StringLiteral"===p.expression.arguments[0].expression.type?p.expression.arguments[0].expression.value:(null===(t=p.expression.typeArguments)||void 0===t?void 0:t.params[0]).literal.value,S(p.expression.arguments[1].expression)));break;case"$Macro":a.push(D(S(p.expression.arguments[0].expression)));break;case"$LitMacro":case"$ExprMacro":case"$TmplMacro":case"$TypeMacro":throw new Error("Expect VariableDeclaration for $Lit, $Expr, $Tmpl, $Type.")}this.replace({type:"EmptyStatement",span:{start:0,end:0,ctxt:0}}),this.addPlugin(a)},leave(e){"macro"===e.label.value&&this.startTracking()}},Identifier(e){const t=this.get("LitMacros",{});e.value in t&&(this.replace(t[e.value]),this.skip())},CallExpression(e){if("Identifier"===e.callee.type){const t=this.get("ExprMacros",{});if(e.callee.value in t)return w(t[e.callee.value],e.arguments.map((e=>e.expression)),e.typeArguments,e.callee.optional)}}});var K=O("$Eval",(function(e){const t=e[0].type;if("StringLiteral"===t)return this.parseExpr(T(e[0].value));if("TemplateLiteral"===t){const t=e=>this.track(e);return f(e[0],{enter(e){if("Identifier"===e.type){const n=t(e.value);n&&n.value&&this.replace(n.value)}}}),this.parseExpr(T(T(this.printExpr(e[0]))))}return this.parseExpr("FunctionExpression"===t||"ArrowFunctionExpression"===t?T(`(${this.printExpr(e[0])})(${e.slice(1).map((e=>this.printExpr(e))).join(",")})`):S(e[0]).toString())}),"(<T>(expr: string) => T) & (<T>(expr: T) => T) & (<F extends (...args: any) => any>(expr: F, ...args: Parameters<F>) => ReturnType<F>)");const U=e=>JSON.stringify(e).replace(/("(start|end|ctxt)":\s*)(\d+)/g,"$10");var W=O("$Ast",(function(e){return this.parseExpr(U("StringLiteral"===e[0].type?this.parseExpr(e[0].value):e[0]))}),'<T>(expr: T) => import("@swc/core").Expression'),q=O("$Env",(function(e,t){var n;if("StringLiteral"!==e[0].type)throw new Error("$Env macro only support StringLiteral as input.");const r=null!==(n=process.env[e[0].value])&&void 0!==n?n:"";if(t&&"TsKeywordType"===(null==t?void 0:t[0].type))switch(t[0].kind){case"boolean":return{type:"BooleanLiteral",value:!!r,span:E};case"number":return{type:"NumericLiteral",value:+r,span:E}}return{type:"StringLiteral",span:E,value:r}}),"<R = string>(key: string) => R"),Q=O("$Stringify",(function(e,t){return{type:"StringLiteral",span:E,value:t&&t.length>0?this.printType(t[0]):this.printExpr(e[0])}}),"((expr: any) => string) & (<T>() => string)"),z=O("$Span",(function(){const e=this.span();return{type:"ArrayExpression",span:E,elements:[{expression:{type:"NumericLiteral",span:E,value:e[0]}},{expression:{type:"NumericLiteral",span:E,value:e[1]}}]}}),"() => [number, number]"),X=O("$Line",(function(){var e;return{type:"NumericLiteral",span:E,value:(null===(e=this.src)||void 0===e?void 0:e.slice(0,this.span()[0]).split(/\r\n|\r|\n/).length)||1}}),"() => number"),Y=O("$Column",(function(){var e,t,n;return{type:"NumericLiteral",span:E,value:(null===(n=null===(t=null===(e=this.src)||void 0===e?void 0:e.slice(0,this.span()[0]))||void 0===t?void 0:t.match(/\n[^\n]*$/))||void 0===n?void 0:n[0].length)||1}}),"() => number"),Z=O("$ID",(function(){return{type:"StringLiteral",span:E,value:m(`${this.src}${this.span()}`)}}),"() => string");function ee(e){return{type:"CallExpression",span:E,callee:{type:"ParenthesisExpression",span:E,expression:{type:"ArrowFunctionExpression",span:E,params:[],body:{type:"BlockStatement",span:E,stmts:[{type:"ThrowStatement",span:E,argument:{type:"NewExpression",span:E,callee:{type:"Identifier",span:E,value:"Error",optional:!1},arguments:[{expression:{type:"StringLiteral",span:E,value:e}}]}}]},async:!1,generator:!1}},arguments:[]}}var te=O("$UnImplemented",(function(){return console.error("not implemented"),ee("not implemented")}),"() => never"),ne=O("$Todo",(function(){console.warn("not yet implemented"),this.replace(ee("not yet implemented"))}),"() => never"),re=O("$UnReachable",(function(){return ee("internal error: entered unreachable code")}),"() => never"),ae=O("$Include",(function(e){var n,r;if("StringLiteral"!==(null===(n=e[0])||void 0===n?void 0:n.type))throw new Error("$Include only accept StringLiteral as input.");let a="commonjs";"StringLiteral"===(null===(r=e[1])||void 0===r?void 0:r.type)&&["es6","commonjs","umd","nodenext"].includes(e[1].value)&&(a=e[1].value);const s={parser:{syntax:"typescript"}},i=G({macros:[],jsc:s});return{type:"CallExpression",span:E,callee:{type:"ParenthesisExpression",span:E,expression:{type:"ArrowFunctionExpression",span:E,params:[],body:{type:"BlockStatement",span:E,stmts:t.parseSync(t.transformFileSync(e[0].value,{jsc:s,plugin:i,module:{type:a}}).code).body},async:!1,generator:!1}},arguments:[]}}),"(path: string, target?: 'es6' | 'commonjs' | 'umd' | 'nodenext') => void"),se=O("$IncludeStr",(function(e){var t;if("StringLiteral"!==(null===(t=e[0])||void 0===t?void 0:t.type))throw new Error("$IncludeStr only accept StringLiteral as input.");return{type:"StringLiteral",value:n.readFileSync(e[0].value).toString(),span:E}}),"(path: string) => string"),ie=O("$IncludeJSON",(function(e){var t,r;if("StringLiteral"!==(null===(t=e[0])||void 0===t?void 0:t.type))throw new Error("$IncludeJSON only accept StringLiteral as input.");let a=n.readFileSync(e[0].value).toString();if("StringLiteral"===(null===(r=e[1])||void 0===r?void 0:r.type)){const t=JSON.parse(a)[e[1].value];a=JSON.stringify(t)}return this.parseExpr(a)}),"(<T extends Record<string, any>>(path: string) => T) & (<R = string>(path: string, key: string) => R)"),pe=O("$WriteFile",(function(e){var t,r;if("StringLiteral"!==(null===(t=e[0])||void 0===t?void 0:t.type))throw new Error("$WriteFile only accept StringLiteral as first parameter.");if("StringLiteral"!==(null===(r=e[1])||void 0===r?void 0:r.type))throw new Error("$WriteFile only accept StringLiteral as second parameter.");return n.writeFileSync(e[0].value,e[1].value,{encoding:"utf-8"}),{type:"Identifier",value:"undefined",span:E}}),"(file: string, data: string) => void"),oe=O("$Concat",(function(e){let t="";const n='only literals (like `"foo"`, `42` and `3.14`) can be passed to `$Concat()`';for(const r of e)switch(r.type){case"StringLiteral":case"BooleanLiteral":case"NumericLiteral":case"BigIntLiteral":t+=r.value;break;case"NullLiteral":t+="null";break;case"Identifier":if("undefined"===r.value){t+=r.value;break}throw new Error(n);default:throw new Error(n)}return{type:"StringLiteral",value:t,span:E}}),"(...args: (string | null | undefined | boolean | number | bigint)[]) => string");const le=(e,t)=>e.reduce(((e,n,r)=>{const a=e+n;return r<t.length?a+t[r]:a}),"");function ce(e,t,n,r){if(e&&"object"==typeof e){const a=Object.keys(e);for(let s=0;s<a.length;s++){const i=a[s],p=e[i],o=t(i,p,e);if(null!=o&&n){n[r]=o;break}"object"==typeof p&&ce(p,t,e,i)}}return e}var ue=F("$Expr",(function(e,...t){const n=t.map(((e,t)=>"_macro_marker_"+t+"_")),r=this.parseExpr(le(e,n),{syntax:"typescript",tsx:!0});ce(r,((e,r,a)=>{if("span"!==e){if("string"==typeof r){const e=n.findIndex((e=>e===r));if(-1!==e)return"__macro$$Start__"+this.printExpr(t[e])+"__macro$$End__"}}else a[e]=E}));const a=JSON.stringify(r,void 0,2).replace(/("__macro\$\$Start__)|(__macro\$\$End__")/g,"").replace(/\\"/g,'"');return this.parseExpr(a)}),'import("@swc/core").Expression'),ye=F("$Quote",(function(e,...t){const n=t.map(((e,t)=>"_macro_marker_"+t+"_")),r=this.parse(le(e,n),{syntax:"typescript",tsx:!0});ce(r,((e,r,a)=>{if("span"!==e){if("string"==typeof r){const e=n.findIndex((e=>e===r));if(-1!==e)return"__macro$$Start__"+this.printExpr(t[e])+"__macro$$End__"}}else a[e]=E}));const a=JSON.stringify(r,void 0,2).replace(/("__macro\$\$Start__)|(__macro\$\$End__")/g,"").replace(/\\"/g,'"');return this.parseExpr(a)}),'(import("@swc/core").Expression)[]');Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return t.parseSync}}),Object.defineProperty(e,"parseAsync",{enumerable:!0,get:function(){return t.parse}}),e.$Ast=W,e.$Column=Y,e.$Concat=oe,e.$Env=q,e.$Eval=K,e.$Expr=ue,e.$ExprMacro=e=>e,e.$ID=Z,e.$Include=ae,e.$IncludeJSON=ie,e.$IncludeStr=se,e.$LabeledMacro=J,e.$Line=X,e.$LitMacro=e=>e,e.$Macro=V,e.$Quote=ye,e.$Span=z,e.$Stringify=Q,e.$TmplMacro=e=>e,e.$Todo=ne,e.$TypeMacro=e=>e,e.$UnImplemented=te,e.$UnReachable=re,e.$WriteFile=pe,e.Walker=d,e.createExprMacro=O,e.createLabeledBlock=(e,t,n,r=!1)=>N(e,(function(e){if(this.import(t,n),"BlockStatement"===e.type)return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"Identifier",value:t,span:{start:0,end:0,ctxt:0}},arguments:[{expression:{type:"ArrowFunctionExpression",generator:!1,async:!1,params:[],body:e,span:{start:0,end:0,ctxt:0}}}],span:{start:0,end:0,ctxt:0}},span:{start:0,end:0,ctxt:0}};if("ExpressionStatement"===e.type&&"ArrowFunctionExpression"===e.expression.type)return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"Identifier",value:t,span:{start:0,end:0,ctxt:0}},arguments:[{expression:e.expression}],span:{start:0,end:0,ctxt:0}},span:{start:0,end:0,ctxt:0}};if(r&&"ExpressionStatement"===e.type&&"ArrayExpression"===e.expression.type)return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"Identifier",value:t,span:{start:0,end:0,ctxt:0}},arguments:e.expression.elements,span:{start:0,end:0,ctxt:0}},span:{start:0,end:0,ctxt:0}};throw new Error("this macro only accept a ArrowFunction or BlockStatement"+(r?" or an ArrayExpression":""))})),e.createLabeledExpr=(e,t,n)=>D({LabeledStatement(r){if(r.label.value===e){if("ExpressionStatement"===r.body.type)return this.import(t,n),r.body.expression={type:"CallExpression",span:{start:109,end:119,ctxt:0},callee:{type:"Identifier",span:{start:109,end:112,ctxt:1},value:t,optional:!1},arguments:[{expression:r.body.expression}]},r.body;throw new Error("this macro only accept an Expression")}}}),e.createLabeledMacro=N,e.createLit=$,e.createLitMacro=C,e.createMacro=D,e.createProxyMacro=j,e.createSwcPlugin=G,e.createTmplMacro=F,e.createTypeMacro=R,e.createWalkPlugin=A,e.defineConfig=function(e){return e},e.evalAst=S,e.evalExpr=T,e.flatExpr=w,e.genConstType=k,e.genExportSpecifier=P,e.genImportSpecifier=L,e.genTsRef=I,e.genTypeImport=_,e.getSpanOffset=x,e.guessType=M,e.hash=m,e.hashMap=v,e.isMacroPlugin=function(e){return!(!e||!e.__macro_plugin__)},e.isMacroProxy=h,e.isNode=function(e){return e&&"object"==typeof e&&"type"in e},e.isRegExp=g,e.macro=H,e.markedNode=function(e,t){return t.marker=e,t},e.noop=b,e.parseExpr=r,e.parseType=a,e.print=o,e.printAst=U,e.printAsync=l,e.printExpr=c,e.printExprAsync=async function(e,t){const{code:n,map:r}=await l({type:"ExpressionStatement",span:E,expression:e},t);return{code:n.replace(/\s*;\s*$/,""),map:r}},e.printRawTmpl=le,e.printTmpl=(e,t)=>e.reduce(((e,n,r)=>{const a=e+n;return r<t.length?a+c(t[r]).code:a}),""),e.printType=u,e.printTypeAsync=async function(e,t){const{code:n,map:r}=await l({type:"TsTypeAliasDeclaration",span:E,declare:!1,id:{type:"Identifier",span:E,value:"__PrintType__",optional:!1},typeAnnotation:e},t);return{code:n.replace(/\s*type\s+__PrintType__\s*=\s*/,"").replace(/\s*;\s*$/,""),map:r}},e.span=E,e.transform=function(e,n){var r;const a=x(),s=B(t.parseSync(e,null===(r=n.jsc)||void 0===r?void 0:r.parser),n,e,a),i=s.dts;return i&&delete s.dts,Object.assign(Object.assign({},t.printSync(s)),{ast:s,dts:i})},e.transformAst=B,e.transformAsync=async function(e,n){var r;const a=x(),s=B(await t.parse(e,null===(r=n.jsc)||void 0===r?void 0:r.parser),n,e,a),i=await t.print(s),p=s.dts;return p&&delete s.dts,Object.assign(Object.assign({},i),{ast:s,dts:p})},e.unMarkNode=function(e){return delete e.marker,e},e.walk=f}({},SwcCore,fs);
